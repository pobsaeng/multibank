<template>
<div>
  <div class="row">
    <div class="col-md-12">
      <div class="modal fade" tabindex="-1" role="dialog" id="add-event-modal">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="box-header with-border">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" @click="closeModal">×</span><span class="sr-only">close</span></button>
                      <h4 class="modal-title">Add a Holiday</h4>
                  </div>
                  <div class="modal-body">
                    <input ref="txtAdd" type="text" class="form-control" placeholder="Enter name"/>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" @click="closeModal">Close</button>
                    <button type="button" class="btn btn-warning" @click="onSave" data-dismiss="modal">Save</button>
                  </div>
              </div>
          </div>
      </div>

      <div id="fullCalModal" class="modal fade">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="box-header with-border">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" @click="closeModal">×</span><span class="sr-only" @click="closeModal">close</span></button>
                      <h4 id="modalTitle" class="modal-title"><span id="title"></span></h4>
                  </div>
                  <div id="modalBody" class="modal-body">
                      เวลาที่เริ่ม: <span id="startTime"></span><br>
                      เวลาที่สิ้นสุด: <span id="endTime"></span><br><br>
                      <p id="eventInfo"></p>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-default" @click="closeModal" data-dismiss="modal">Close</button>
                      <button class="btn btn-primary">Event Page</button>
                  </div>
              </div>
          </div>
      </div>
      </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <span id="calendar"></span>
    </div>
  </div>
</div>
</template>

<script>
import $ from "jquery";
import moment from "moment";

export default {
  name: "hello",
  data() {
    return {
      selfEL: {},
      inputField: [],
      modalStatus: false
    };
  },
  mounted() {
    var me = this;
    this.selfEL = $(me.$el);

    me.$on("modalStatus", function(bool) {
      me.modalStatus = bool;
    });

    me.$nextTick(function() {
      me.createButtonEL();
    });

    me.createCalendar();
  },
  methods: {
    createCalendar() {
      var me = this;

      var args = {
        header: {
          left: "prev,next today",
          center: "title",
          right: ""
          // right: "month,agendaWeek,agendaDay"
        },
        locale: "th",
        displayEventTime: false,
        defaultView: "month",
        editable: false,
        droppable: false,
        events(start, end, timezone, callback) {
          callback([
            {
              title: "Hotmail",
              start: moment().add(2),
              end: moment().add(2)
            }
          ]);
        },
        dayClick(date, event, view) {},
        eventClick: function(event, jsEvent, view) {
          var data = event.start.format("YYYY-MM-DD");
          var dia = event.start.format("dddd");
          console.log(data, dia);
        },
        eventRender: function(event, element) {
          console.log("eventRender!");
          var data = event.start.format("YYYY-MM-DD");
          var dia = event.start.format("dddd");
          console.log(data, dia);

          element.bind("dblclick", function(eventE, jsEvent, view) {
            me.$emit("modalStatus", true);

            $("#title").html(event.title);
            $("#startTime").html(moment(event.start).format("MMM Do h:mm A"));
            $("#endTime").html(moment(event.end).format("MMM Do h:mm A"));
            $("#eventInfo").html(event.description);
            $("#eventLink").attr("href", event.url);
            $("#fullCalModal").modal({backdrop: 'static', keyboard: false});
          });
        }
      };

      this.selfEL.on("dblclick", function(event) {
        event.preventDefault();
        if (!me.modalStatus) {
          $("#add-event-modal").modal({backdrop: 'static', keyboard: false});
        }
      });

      this.selfEL.on("contextmenu", function(e) {
        e.preventDefault();
        if (e.button == 2) {
        }
      });

      this.selfEL.fullCalendar(args);
    },
    createButtonEL() {
      var divCreate = document.createElement("DIV");
      var btnCreate = document.createElement("BUTTON");
      btnCreate.setAttribute("data-toggle", "modal");
      // btnCreate.setAttribute("data-target", "#add-event-modal");
      btnCreate.classList = "btn btn-warning";
      btnCreate.textContent = "Create New";
      btnCreate.addEventListener("click", function(e) {
        $("#add-event-modal").modal({backdrop: 'static', keyboard: false});
      });
      divCreate.appendChild(btnCreate);
      document.getElementsByClassName("fc-right")[0].appendChild(divCreate);
    },
    onSave(e) {
      console.log(this.$refs.txtAdd.value);
    },
    closeModal() {
      this.$emit("modalStatus", false);
    }
  },
  components: {}
};
</script>

<style scoped>
.modal-header {
  border-bottom: 1px solid #ccc;
}
.modal-body {
  overflow-y: auto;
}

</style>
